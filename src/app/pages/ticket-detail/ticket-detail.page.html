<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/ticket-list"></ion-back-button>
    </ion-buttons>
    <ion-title>Ticket Details</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="presentActionSheet()">
        <ion-icon name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Lade Ticket...</p>
  </div>

  <!-- Ticket Details -->
  <div *ngIf="!isLoading && ticket">
    <!-- Titel und Status -->
    <ion-card>
      <ion-card-header>
        <div class="header-content">
          <ion-icon 
            [name]="getCategoryIcon(ticket.category)" 
            [color]="getStatusColor(ticket.status)"
            class="category-icon">
          </ion-icon>
          <div>
            <ion-card-title>{{ ticket.title }}</ion-card-title>
            <ion-card-subtitle>{{ ticket.category }}</ion-card-subtitle>
          </div>
        </div>
      </ion-card-header>
      <ion-card-content>
        <ion-badge [color]="getStatusColor(ticket.status)" class="status-badge">
          {{ ticket.status }}
        </ion-badge>
      </ion-card-content>
    </ion-card>

    <!-- Beschreibung -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Beschreibung</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>{{ ticket.description }}</p>
      </ion-card-content>
    </ion-card>

    <!-- Standort -->
    <ion-card *ngIf="ticket.location">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="location"></ion-icon>
          Standort
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>{{ ticket.location }}</p>
      </ion-card-content>
    </ion-card>

    <!-- Zeitstempel -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="time"></ion-icon>
          Zeitstempel
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-label>
              <h3>Erstellt</h3>
              <p>{{ ticket.created_at | date:'dd.MM.yyyy HH:mm' }}</p>
            </ion-label>
          </ion-item>
          <ion-item *ngIf="ticket.updated_at && ticket.updated_at !== ticket.created_at">
            <ion-label>
              <h3>Aktualisiert</h3>
              <p>{{ ticket.updated_at | date:'dd.MM.yyyy HH:mm' }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Status Ändern -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Status ändern</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-segment [(ngModel)]="ticket.status" (ionChange)="updateStatus()">
          <ion-segment-button [value]="ticketStatus.OFFEN">
            <ion-label>Offen</ion-label>
          </ion-segment-button>
          <ion-segment-button [value]="ticketStatus.IN_BEARBEITUNG">
            <ion-label>In Arbeit</ion-label>
          </ion-segment-button>
          <ion-segment-button [value]="ticketStatus.GELOEST">
            <ion-label>Gelöst</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-card-content>
    </ion-card>

    <!-- Aktionen -->
    <div class="actions">
      <ion-button expand="block" color="danger" (click)="deleteTicket()">
        <ion-icon slot="start" name="trash"></ion-icon>
        Ticket löschen
      </ion-button>
    </div>
  </div>

  <!-- Nicht gefunden -->
  <ion-card *ngIf="!isLoading && !ticket">
    <ion-card-content>
      <p class="ion-text-center">Ticket nicht gefunden</p>
    </ion-card-content>
  </ion-card>
</ion-content>
